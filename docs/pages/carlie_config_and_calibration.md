---
sort: 4
---

# Carlie Config and Calibration

## Config Parameters
The platform comes with some default parameters which set aspects such as acceleration and velocity limits. Fortunately these can all be easily changed through a YAML config file. The config file is located at */etc/carlie.conf*. In this file the config parameters/values will be commented out. You will need to uncomment them to override the defaults (the defaults are located at *ros_path/carlie_base/config/carlie_config.yaml*). To change the file:

1. Open up a terminal, either via the applications GUI or by pressing `ctrl+alt+t` on the keyboard.
3. Use Nano, or Vim, to edit the file `nano /etc/carlie.conf`.
4. Uncomment the parameter you wish to specify and change the value.
5. Once completed save the file. In Nano this is done by pressing `ctrl+x` and then entering `y` to the question do you wish to overwrite this file.

The config values and their meaning are below. The following parameters you may wish to change and are dependent on your application and environment (any parameters followed by (*) can be dynamically reconfigured; the calibration routine for the center_steering_angle parameter below shows you how you can update these at runtime):

* **max_reverse_velocity(*)** - this is the maximum reverse velocity you want the car to be able to go; specified in m/s and does require a negative sign (e.g. -1m/s).
* **max_forward_velocity(*)** - this is the maximum forward velocity you want the platform to go; specified in m/s.
* **acceleration(*)** - is the acceleration limit; specified in m/s/s.
* **ignore_proximity_sensors(*)** - set this to true to ignore the four short range LIDAR bumper sensors. The sensors will still be measured and reported but the vehicle will not stop. Current default is true as need to write a filter for spurious false-positives when the car is undulating.
* **collisision_detection_distance(*)** - the approximate distance in millimetres for when the LIDAR bumper sensors should stop the car.

The parameters associated with the low level odometry covariance you may wish to change, but you should not need to.
* **covar_position_\<value\>** - the covariance for various element of the reported odometry from the low-level; utilised in the *carlie_base/low_level_converter_node*.

The following parameters are specific to your exact hardware and while the defaults will probably be sufficient you may wish to calibrate them (see below). The parameter you will probably wish to calibrate is the center_steering_angle, else you may get a slight left/right drift when driving straight.
* **min_throttle_pulse_width** - the minimum throttle (linear velocity) pulse width generated by the RC remote; specified in micro-seconds. The value should be approximately 1000us.
* **max_throttle_pulse_width** - the maximum throttle (linear velocity) pulse width generated by the RC remote; specified in micro-seconds. The value should be approximately 2000us.
* **center_throttle_pulse_width** - the pulse generated when the RC throttle is in its neutral position; specified in micro-seconds. The value should be approximately 1500us.
* **min_steering_angle** - the minimum steering angle possible by the car (i.e. the maximum angle the wheels can rotate to the left, when looking in the direction of travel; specified in radians and should be negative (e.g. -0.7854 radians).
* **max_steering_angle** - the maximum steering angle possible by the car (i.e. the maximum angle the wheels can rotate to the left, when looking in the direction of travel); specified in radians default is 0.7854 radians.
* **center_steering_angle(*)** - This specifies the angle of the steering servo which corresponds to 0 degree turning angle for Carlie (i.e. the angle that the steering servo should be set to in order for the car to drive straight). The units are in radians and the value will be approximately 1.75 radians (100 degrees). Due to the discretisation in the steering servo, minor changes in this value may not result in physical changes in the steering angle.
* **min_steering_angle_pulse_width** - the minimum pulse width generated by the RC remote when steering; specified in micro-seconds. The value should be approximately 1000us.
* **max_steering_angle_pulse_width** - the maximum pulse width generated by the RC remote when steering; specified in micro-seconds. The value should be approximately 2000us.
* **lidar_front_right_address** - the I2C address of the front right LIDAR bumper sensor.
* **lidar_front_left_address** - the I2C address of the front left LIDAR bumper sensor.
* **lidar_back_right_address** - the I2C address of the back right LIDAR bumper sensor.
* **lidar_back_left_address** - the I2C address of the back left LIDAR bumper sensor.

The following parameters should not need to be changed. They are merely broken out as config values for ease of use, and so the microcontroller does not need to be reprogrammed if they are altered.
* **wheel_base** - the distance between the front and rear axle of the platform; specified in metres.
* **wheel_radius** - the radius of the wheels; specified in metres defaults to 0.059m.
* **gear_ratio_wheel_2_motor** - the gear ratio from the wheel to the motor, should be a value greater than 1.
* **motor_poles** - the number of motor poles, as specified by the VESC documentation. We believe the VESC documentation is wrong as the motor should have more than 1 pole, but the conversion required to go from E-RPM to RPM is only sensible if you use a value of 1 here.
* **motor_ticks_per_revolution** - the number of motor ticks per single revolution.
* **battery_voltage_offset** - the offset between the battery voltage measured by the VESC and the actual voltage due to voltage offsets caused by components such as diodes (this should be approximately constant); specified in volts.

## Calibrating Carlie

The main parameter you will need to calibrate is the center_steering_angle. The easiest way to calibrate the steering angle is as follows:

1. Turn on the car and make sure it is in Logitech Tele-Operation mode.
2. Manually drive the car forward a few metres and see if there is any left/right drift.
3. If there is drift, slightly alter the center_steering_angle parameter by opening up a terminal and running the command `rosparam set center_steering_angle <value>`. If it is steering left add(?) to this value, if the car is drifting right subtract(?) from this value. You can get the current value by runnign the command `rosparam get center_steering_angle`.
4. Repeat steps 2 and 3 until you are happy with the result. You will most likely not be able to get a car that can drive perfectly straight over a long straight due to the fact the discritisation of the angles the servo can physically achieve.
5. Once you are happy with the result you will need to make the change official by updating the local config file. To do this follow the steps outlined above.

If you plan on using the RC remote to tele-operate Carlie you may wish to calibrate the pulse width RC remote parameters too. However, the default parameters probably will be okay. To calibrate:

1. Somehow upload the calibration firmware. Gavin to provide instructions.
2. James how do they use it?
3. More details to come.

**Tip:** on the side of the RC remote there is a steering trim knob. If this steering trim does not align with the value specified in the *center_throttle_pulse_width* parameter your car will drift left or right, and changing the steering trim will change the wheel alignment. We recommend first set the *center_steering_angle* parameter as outlined below while using the Logitech tele-operation mode. After calibrating the *center_steering_angle*, set the steering trim knob to the neutral position, or as close as possible (1500us pulse width). Then calibrate the pulse width parameters.