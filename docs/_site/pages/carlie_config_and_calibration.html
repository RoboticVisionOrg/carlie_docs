<!DOCTYPE html> <!-- rundocs.io, theme: jekyll-rtd-theme, based on v1.1.7 --> <html class="writer-html5" lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <meta content="IE=Edge" http-equiv="X-UA-Compatible"> <title>Carlie Config and Calibration · Carlie Documentation (ACRV)</title> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } function debug() { console.debug.apply(console, arguments); } gtag("js", new Date()); if ("serviceWorker" in navigator) { navigator.serviceWorker.register("/sw.caches.js"); } else { debug("Service Worker not supported!"); } </script> <!-- meta --> <meta name="description" content="Carlie Config and Calibration Config Parameters The platform comes with some default parameters which set aspects such as acceleration and velocity..."> <meta name="author" content="RoboticVisionOrg"> <meta name="revised" content="d3633ad"> <meta name="generator" content="jekyll-rtd-theme v1.1.7"> <!-- meta-ogp --> <meta property="og:title" content="Carlie Config and Calibration · Carlie Documentation (ACRV)"> <meta property="og:description" content="Carlie Config and Calibration Config Parameters The platform comes with some default parameters which set aspects such as acceleration and velocity..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/pages/carlie_config_and_calibration.html"> <meta property="og:type" content="article"> <meta property="article:author" content="RoboticVisionOrg"> <meta property="article:published_time" content="2020-09-11T22:24:17+10:00"> <meta property="article:modified_time" content="2020-09-11T22:24:17+10:00"> <!-- meta-custom --> <!-- schema --> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/pages/carlie_config_and_calibration.html" }, "headline": "Carlie Config and Calibration · Carlie Documentation (ACRV)", "image": [], "author": { "@type": "Person", "name": "RoboticVisionOrg" }, "datePublished": "2020-09-11T22:24:17+10:00", "dateModified": "2020-09-11T22:24:17+10:00", "publisher": { "@type": "Organization", "name": "RunDocs", "logo": { "@type": "ImageObject", "url": "https://rundocs.io/logo.png" } }, "description": "Carlie Config and Calibration Config Parameters The platform comes with some default parameters which set aspects such as acceleration and velocity..." } </script> <!-- link --> <link rel="canonical" href="http://localhost:4000/pages/carlie_config_and_calibration.html"> <link rel="prev" href="http://localhost:4000/pages/carlie_networking_interfaces.html"> <link rel="next" href="http://localhost:4000/pages/carlie_running_existing_capabilities.html"> <!-- theme --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@1.1.7/assets/css/theme.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@1.1.7/assets/css/rougify/github.css"> <style>.shadow-box,.album .item img,.admonition{box-shadow:0 1px 1px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2)}.flex,.album,.album .item{display:-webkit-flex;display:flex;flex-wrap:wrap;flex-direction:row}.album .item{flex:auto;margin:10px;justify-content:center}.album .item:hover{opacity:0.9}.album .item img{width:100%}.wy-embed-wrap{width:100%;padding:1em 1.5em;font-size:14px;line-height:20px}.wy-embed-wrap .wy-embed{text-align:center;padding:1em;color:#c2c2c2;background:#4e4b4b;border:1px solid #a0a0a0;border-radius:5px}.wy-embed-wrap .wy-embed a{color:#e6e6e6}.wy-embed-wrap .wy-embed img{max-width:100%}p{font-size:15px}footer p{font-size:14px;text-align:center}.progress:after{display:inline-block;content:"\2026";width:0;overflow:hidden;vertical-align:bottom;animation:ellipsis steps(4, end) 1000ms infinite}@keyframes ellipsis{to{width:1.25em}}.fa-angle-double-right{font-size:13px}.rst-versions.shift-up{overflow-y:auto}.wy-nav-side{padding-bottom:3em}.wy-nav-top{padding:0}.wy-nav-top .flex,.wy-nav-top .album,.wy-nav-top .album .item,.album .wy-nav-top .item{align-items:center}.wy-nav-top .flex i,.wy-nav-top .album i,.album .wy-nav-top .item i{padding:10px;font-size:20px}.wy-nav-top .flex .wy-nav-title,.wy-nav-top .album .wy-nav-title,.album .wy-nav-top .item .wy-nav-title{flex:auto}.wy-nav-top .flex .wy-nav-title a,.wy-nav-top .album .wy-nav-title a,.album .wy-nav-top .item .wy-nav-title a{margin-left:-30px;padding:10px}.wy-menu-vertical li.toctree-l1.current li.toctree-l2>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l1.current li.toctree-l2>a span{padding-right:3px}.wy-menu-vertical li.toctree-l2.current li.toctree-l3>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l2.current li.toctree-l3>a span{padding-right:3px}.wy-menu-vertical li.toctree-l3.current li.toctree-l4>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l3.current li.toctree-l4>a span{padding-right:3px}.wy-menu-vertical li.toctree-l4.current li.toctree-l5>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l4.current li.toctree-l5>a span{padding-right:3px}.wy-menu-vertical li.toctree-l5.current li.toctree-l6>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l5.current li.toctree-l6>a span{padding-right:3px}.wy-menu-vertical li.toctree-l6.current li.toctree-l7>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l6.current li.toctree-l7>a span{padding-right:3px}.wy-menu-vertical li.toctree-l7.current li.toctree-l8>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l7.current li.toctree-l8>a span{padding-right:3px}.wy-menu-vertical li.toctree-l8.current li.toctree-l9>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l8.current li.toctree-l9>a span{padding-right:3px}.wy-menu-vertical li.toctree-l9.current li.toctree-l10>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l9.current li.toctree-l10>a span{padding-right:3px}.wy-menu-vertical li.toctree-l10.current li.toctree-l11>a{display:-webkit-flex;display:flex;align-items:center}.wy-menu-vertical li.toctree-l10.current li.toctree-l11>a span{padding-right:3px}.wy-nav-content{max-width:900px}.rst-content .mermaid,.rst-content ol,.rst-content ul{overflow-x:auto}.rst-content a code.literal{color:#2980b9}.rst-content code,.rst-content div[class^=highlight] pre,.rst-content pre{font-family:monospace;font-size:12px}.rst-content blockquote{padding:0 1em;color:#6a737d;border-left:0.25em solid #dfe2e5}.rst-content .rundocs{display:none}.rst-content .highlighted-box{border:1px solid #f1c40f}.wy-table-responsive table td{white-space:initial}#search-results .context{word-break:break-all}#search-results li:last-child{border-bottom:0;padding-bottom:0}@media screen and (max-width: 768px){.wy-nav-content-wrap .wy-nav-content{padding:1em}}@media screen and (max-width: 480px){.wy-breadcrumbs li.wy-breadcrumbs-aside{display:initial}}</style> <!-- icon --> <link rel="icon" type="image/svg+xml" href="/favicon.svg"> <!-- script --> <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@1.1.7/assets/js/html5shiv.min.js"></script><![endif]--> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@1.1.7/assets/js/jquery.min.js"></script> <script> const ui = { baseurl: "", title: "Carlie Documentation (ACRV)", lang: "en", admonition: { note: "Note", tip: "Tip", warning: "Warning", danger: "Danger" } }; </script> </head> <body class="wy-body-for-nav"> <div class="wy-grid-for-nav"> <!-- NAV --> <nav data-toggle="wy-nav-shift" class="wy-nav-side"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a href="/" class="icon icon-home"> Carlie Documentation (ACRV)</a> <div class="version"></div> <div role="search"> <form id="rtd-search-form" class="wy-form" action="/search.html" method="get" autocomplete="off"> <input type="text" name="q" placeholder="Search Docs..."> <input type="hidden" name="lang" value="en"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> </ul> <p class="caption"><span class="caption-text">Carlie Documentation</span></p><ul> <li class="toctree-l1 " data-sort="1" data-level="1"> <a class="reference internal " href="/pages/power_management.html">1. Carlie Power Management</a> </li><li class="toctree-l1 " data-sort="2" data-level="1"> <a class="reference internal " href="/pages/starting_up_carlie.html">2. Starting Up and Driving Carlie</a> </li><li class="toctree-l1 " data-sort="3" data-level="1"> <a class="reference internal " href="/pages/carlie_networking_interfaces.html">3. Carlie Networking Interfaces</a> </li><li class="toctree-l1 current" data-sort="4" data-level="1"> <a class="reference internal current" href="/pages/carlie_config_and_calibration.html">4. Carlie Config and Calibration</a> </li><li class="toctree-l1 " data-sort="5" data-level="1"> <a class="reference internal " href="/pages/carlie_running_existing_capabilities.html">5. Running Existing Demos and Capabilities on Carlie</a> </li><li class="toctree-l1 " data-sort="7" data-level="1"> <a class="reference internal " href="/pages/3_levels_of_carlie.html">7. The 3 Levels of Carlie</a> </li></ul> </div></div> </nav> <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"> <!-- MOBILE NAV --> <nav class="wy-nav-top" aria-label="top navigation"> <div class="flex"> <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <div class="wy-nav-title"> <a href="/">Carlie Documentation (ACRV)</a> </div> </div> </nav> <div class="wy-nav-content"> <div class="rst-content"> <div role="navigation" aria-label="breadcrumbs navigation"> <ul class="wy-breadcrumbs"> <li> <a href="/" class="icon icon-home"></a><i class="fa fa-angle-double-right"></i> </li> <li> <a href="/pages/">Pages</a><i class="fa fa-angle-double-right"></i> </li> <li>Carlie Config and Calibration</li><li class="wy-breadcrumbs-aside"> <a href="https://github.com/RoboticVisionOrg/carlie_docs/edit/gh-pages/pages/carlie_config_and_calibration.md" class="fa fa-edit" target="_blank"></a> </li></ul> <hr> </div> <div role="main" itemscope="itemscope" itemtype="http://schema.org/Article"> <div class="document" itemprop="articleBody"><div class="section"><h1 id="carlie-config-and-calibration">Carlie Config and Calibration</h1> <h2 id="config-parameters">Config Parameters</h2> <p>The platform comes with some default parameters which set aspects such as acceleration and velocity limits. Fortunately these can all be easily changed through a YAML config file. The config file is located at <strong>insert config file location</strong>. In this file the config parameters/values will be commented out. You will need to uncomment them to override the defaults (the defaults are located at <strong>file location</strong>). To change the file:</p> <ol> <li>Open up a terminal, either via the applications GUI or by pressing <code class="literal">ctrl+alt+t</code> on the keyboard.</li> <li>Change directory to the location of the config file <code class="literal">cd file_location</code>.</li> <li>Use Nano, or Vim, to edit the file <code class="literal">nano file_name</code>.</li> <li>Uncomment the parameter you wish to specify and change the value.</li> <li>Once completed save the file. In Nano this is done by pressing <code class="literal">ctrl+x</code> and then entering <code class="literal">y</code> to the question do you wish to overwrite this file.</li> </ol> <p>The config values and their meaning are below. The following values you will wish to change depending on your application/environment (any parameters followed by (*) can be dynamically reconfigured; the calibration routine for the center_steering_angle parameter below shows you how you can update these at runtime):</p> <ul> <li><strong>max_reverse_velocity(*)</strong> - this is the maximum reverse velocity you want the car to be able to go; specified in m/s and does require a negative sign (e.g. -1m/s).</li> <li><strong>max_forward_velocity(*)</strong> - this is the maximum forward velocity you want the platform to go; specified in m/s.</li> <li><strong>acceleration(*)</strong> - is the acceleration limit; specified in m/s/s.</li> <li><strong>ignore_proximity_sensors(*)</strong> - set this to true to ignore the four short range LIDAR bumper sensors. The sensors will still be measured and reported but the vehicle will not stop. Current default is true as need to write a filter for spurious false-positives when the car is undulating.</li> <li><strong>collisision_detection_distance(*)</strong> - the approximate distance in millimetres for when the LIDAR bumper sensors should stop the car.</li> </ul> <p>The parameters associated with the low level odometry covariance you may wish to change, but you should not need to.</p> <ul> <li>**covar_position_<value>** - the covariance for various element of the reported odometry from the low level.</value></li> </ul> <p>The following parameters are specific to your exact hardware and while the defaults will probably be sufficient you may wish to calibrate them (see below). The parameter you will probably wish to calibrate is the center_steering_angle, else you may get a left/right drift when wanting to drive straight.</p> <ul> <li><strong>min_throttle_pulse_width</strong> - the minimum throttle (linear velocity) pulse width generated by the RC remote; specified in micro-seconds should be approximately 1000us.</li> <li><strong>max_throttle_pulse_width</strong> - the maximum throttle (linear velocity) pulse width generated by the RC remote; specified in micro-seconds should be approximately 2000us.</li> <li><strong>center_throttle_pulse_width</strong> - the pulse generated when the RC throttle is in its neutral position; specified in micro-seconds should be approximately 1500us.</li> <li><strong>min_steering_angle</strong> - the minimum steering angle possible by the car (wheels are facing to the right when looking in direction of travel); specified in radians and should be negative (e.g. -0.7854 radians).</li> <li><strong>max_steering_angle</strong> - the maximum steering angle possible by the car (wheels are facing to the left when looking in direction of travel); specified in radians default.</li> <li><strong>center_steering_angle(*)</strong> - placing the steering servo so 100 degrees corresponds to exactly straight is impossible, hence this parameter. This specifies the center position of the steering; units are in radians and should be approximately 1.75 radians (100 degrees).</li> <li><strong>min_steering_angle_pulse_width</strong> - the minimum pulse width generated by the RC remote when steering; specified in micro-seconds should be approximately 1000us.</li> <li><strong>max_steering_angle_pulse_width</strong> - the maximum pulse width generated by the RC remote when steering; specified in micro-seconds should be approximately 2000us.</li> <li><strong>lidar_front_right_address</strong> - the I2C address of the front right LIDAR bumper sensor.</li> <li><strong>lidar_front_left_address</strong> - the I2C address of the front left LIDAR bumper sensor.</li> <li><strong>lidar_back_right_address</strong> - the I2C address of the back right LIDAR bumper sensor.</li> <li><strong>lidar_back_left_address</strong> - the I2C address of the back left LIDAR bumper sensor.</li> </ul> <p>The following parameters should not need to be changed. They are merely broken out as config values for ease of use, so the Teensy does not need to be reprogrammed each time.</p> <ul> <li><strong>wheel_base</strong> - the distance between the front and rear axle of the platform; specified in metres.</li> <li><strong>wheel_radius</strong> - the radius of the wheels; specified in metres defaults to 0.059m.</li> <li><strong>gear_ratio_wheel_2_motor</strong> - the gear ratio from the wheel to the motor, should be a value greater than 1.</li> <li><strong>motor_poles</strong> - the number of motor poles, as specified by the VESC documentation. We believe the VESC documentation is wrong as the motor should have more than 1 pole, but the conversion required to go from E-RPM to RPM is only sensible if you use a value of 1 here.</li> <li><strong>motor_ticks_per_revolution</strong> - the number of motor ticks per single revolution.</li> <li><strong>battery_voltage_offset</strong> - the offset between the battery voltage measured by the VESC and the actual voltage due to voltage offsets caused by components such as diodes (this should be approximately constant); specified in volts.</li> </ul> <h2 id="calibrating-carlie">Calibrating Carlie</h2> <p>The main parameter you will need to calibrate is the center_steering_angle. The easiest way to calibrate the steering angle is as follows:</p> <ol> <li>Turn on the car and make sure it is in Logitech Tele-Operation mode.</li> <li>Manually drive the car forward a few metres and see if there is any left/right drift.</li> <li>If there is drift slightly alter the center_steering_angle parameter by opening up a terminal and running the command <code class="literal">rosparam set center_steering_angle &lt;value&gt;</code>. If it is steering left add(?) to this value, if right subtract(?) from it.</li> <li>Repeat steps 2 and 3 until you are happy with the result. You will most likely not be able to get a car that can drive perfectly straight over a long straight due to the fact the discritization of the angles the servo can physically achieve.</li> <li>Once you are happy with the result you will need to make the change official by updating the local config file. To do this follow the steps outlined above. If you cannot remember what value you set the center_steering_angle parameter to run the following command <code class="literal">rosparam get center_steering_angle</code>.</li> </ol> <p>The default pulse width RC remote parameters will do in most cases. However, we do recommend you calibrate them. To calibrate:</p> <ol> <li>Somehow upload the calibration firmware. Gavin this is on you</li> <li>James how do they use it?</li> </ol> <p><strong>Tip:</strong> on the side of the RC remote there is a steering trim knob. If this is steering trim does not align with the value specified in the <em>center_throttle_pulse_width</em> parameter your car will drift left or right. Changing the steering trim will change the wheel alignment. However, we recommend first set the <em>center_steering_angle</em> parameter as outlined below. After setting this parameter set the steering trim knob to the neutral position, or as close as possible (1500us pulse width). Then calibrate the pulse width parameters, again see below for calibration routine. Then when you are using the RC remote changing the steering trim should not cause errors in reported measurements due to a mismatch in offsets.</p> </div></div> </div> <footer><div class="rst-footer-buttons" role="navigation" aria-label="footer navigation"><a href="/pages/carlie_running_existing_capabilities.html" class="btn btn-neutral float-right" title="Running Existing Demos and Capabilities on Carlie" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span> </a><a href="/pages/carlie_networking_interfaces.html" class="btn btn-neutral float-left" title="Carlie Networking Interfaces" accesskey="p" rel="prev"> <span class="fa fa-arrow-circle-left"></span> Previous</a></div><hr><div role="contentinfo" class="copyright"> <p> <i class="fa fa-copyright"></i> Copyright 2020, RoboticVisionOrg <span class="commit"> Revision <code>d3633ad</code> </span></p> </div><div role="contentinfo" class="copyright rundocs"> <p>Powered by <a href="https://rundocs.io">rundocs.io</a> using the jekyll docs theme <a href="https://rundocs.github.io/jekyll-rtd-theme">jekyll-rtd-theme</a></p> </div> </footer> </div> </div> </section> </div><div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions"> <span class="rst-current-version" data-toggle="rst-current-version"> <span class="fa fa-book"> Carlie Documentation (ACRV)</span> gh-pages <span class="fa fa-caret-down"></span> </span> <div class="rst-other-versions"><dl> <dt>GitHub</dt><dd><a href="https://github.com/RoboticVisionOrg/carlie_docs"><i class="fa fa-github"></i> Homepage</a></dd> <dd><a href="https://github.com/RoboticVisionOrg/carlie_docs/issues"><i class="fa fa-question-circle-o"></i> Issues</a></dd> <dd><a href="https://github.com/RoboticVisionOrg/carlie_docs/zipball/gh-pages"><i class="fa fa-download"></i> Download</a></dd></dl> <dl> <dt>Translations</dt><dd><a href="/"><i class="fa fa-language"></i> en</a> </dd></dl> <dl> <dt>Theme Plugins</dt> <dd><a href="https://rubygems.org/gems/jekyll-default-layout"><i class="fa fa-cog"></i> jekyll-default-layout</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-readme-index"><i class="fa fa-cog"></i> jekyll-readme-index</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-github-metadata"><i class="fa fa-cog"></i> jekyll-github-metadata</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-titles-from-headings"><i class="fa fa-cog"></i> jekyll-titles-from-headings</a></dd> <dd><a href="https://rubygems.org/gems/jemoji"><i class="fa fa-cog"></i> jemoji</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-avatar"><i class="fa fa-cog"></i> jekyll-avatar</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-mentions"><i class="fa fa-cog"></i> jekyll-mentions</a></dd> </dl> <dl> <dt>Statistics</dt> <dd> <a href="https://github.com/rundocs/analytics" target="_blank"> Total visits: <span id="counter"><span class="progress"></span></span> <i class="fa fa-eye"></i> </a> </dd> </dl> <script> $(document).ready(function() { let analytics = new URL("https://rundocs-analytics.glitch.me/collect?v=1.1.7&lang=en"); analytics.searchParams.append("user_lang", navigator.language); analytics.searchParams.append("host", location.host); analytics.searchParams.append("platform", navigator.platform); $.getJSON(analytics.toString(), (data) => $("#counter").html(data.count)); }); </script> <hr> <small> <span> Built with <a href="https://jekyllrb.com/">Jekyll</a> using the <a href="https://github.com/rundocs/jekyll-rtd-theme">jekyll-rtd-theme</a> (MIT) </span> </small> </div> </div> <!-- script --> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@1.1.7/assets/js/anchor.min.js"></script> <script> $(document).ready(function() { function initialize(name) { let link = $(".wy-menu-vertical").find(`[href="${decodeURI(name)}"]`); if (link.length > 0) { $(".wy-menu-vertical .current").removeClass("current"); link.addClass("current"); link.closest("li.toctree-l1").parent().addClass("current"); link.closest("li.toctree-l1").addClass("current"); link.closest("li.toctree-l2").addClass("current"); link.closest("li.toctree-l3").addClass("current"); link.closest("li.toctree-l4").addClass("current"); link.closest("li.toctree-l5").addClass("current"); } } function toggleCurrent(link) { let closest = link.closest("li"); closest.siblings("li.current").removeClass("current"); closest.siblings().find("li.current").removeClass("current"); closest.find("> ul li.current").removeClass("current"); closest.toggleClass("current"); } function toc() { $(".wy-menu-vertical li.current").append('<ul class="content-toc"></ul>').html(function() { let level = parseInt(this.dataset.level); let temp = 0; let stack = [$(this).find(".content-toc")]; $(".document").find("h2,h3,h4,h5,h6").each(function() { let anchor = $("<a/>").addClass("reference internal").text($(this).text()).attr("href", `#${this.id}`); let tagLevel = parseInt(this.tagName.slice(1)) - 1; if (tagLevel > temp) { let parent = stack[0].children("li:last")[0]; if (parent) { stack.unshift($("<ul/>").appendTo(parent)); } } else { stack.splice(0, Math.min(temp - tagLevel, Math.max(stack.length - 1, 0))); } temp = tagLevel; $("<li/>").addClass(`toctree-l${level + tagLevel}`).append(anchor).appendTo(stack[0]); }); if (!stack[0].html()) { stack[0].remove(); } }); } function set(name, value) { return localStorage.setItem(name, value); } function get(name) { return localStorage.getItem(name) || false; } function restore() { let scroll = get("scroll"); let scrollTime = get("scrollTime"); let scrollHost = get("scrollHost"); if (scroll && scrollTime && scrollHost) { if (scrollHost == location.host && (Date.now() - scrollTime < 6e5)) { $(".wy-side-scroll").scrollTop(scroll); } } $(".wy-side-scroll").scroll(function() { set("scroll", this.scrollTop); set("scrollTime", Date.now()); set("scrollHost", location.host); }); } function highlight() { let text = new URL(location.href).searchParams.get("highlight"); let box = ".highlighted-box"; if (text) { $(".section").find("*").each(function() { try { if (this.outerHTML.match(new RegExp(text, "im"))) { $(this).addClass("highlighted-box"); } } catch (e) { debug(e.message); } }); $(".section").find(box).each(function() { if (($(this).find(box).length > 0)) { $(this).removeClass(box); } }); } } anchors.add(); toc(); initialize(location.pathname); restore(); highlight(); /* nested ul */ $(".wy-menu-vertical ul").siblings("a").each(function() { let link = $(this); let expand = $('<span class="toctree-expand"></span>'); expand.on("click", function(e) { e.stopPropagation(); toggleCurrent(link); return false; }); link.prepend(expand); }); /* admonition */ $(".admonition-title").each(function() { $(this).html(ui.admonition[$(this).attr("ui")]); }); /* bind */ $(document).on("click", '[data-toggle="wy-nav-top"]', function() { $('[data-toggle="wy-nav-shift"]').toggleClass("shift"); $('[data-toggle="rst-versions"]').toggleClass("shift"); }); $(document).on("click", ".wy-menu-vertical .current ul li a", function() { $('[data-toggle="wy-nav-shift"]').removeClass("shift"); $('[data-toggle="rst-versions"]').toggleClass("shift"); toggleCurrent($(this)); }); $(document).on("scroll", function() { let start = $(this).scrollTop() + 5; let items = []; $(".document").find("h1,h2,h3,h4,h5,h6").each(function() { items.push({ offset: $(this).offset().top, id: this.id, level: parseInt(this.tagName.slice(1)) }); }); for (let i = 0; i < items.length; i++) { if (start > items[i].offset) { if (i < items.length - 1) { if (start < items[i + 1].offset) { if (items[i].level == 1) { initialize(location.pathname); } else { initialize("#" + items[i].id); } } } else { initialize("#" + items[i].id); } } } }); $(document).on("click", '[data-toggle="rst-current-version"]', function() { $('[data-toggle="rst-versions"]').toggleClass("shift-up"); }); $(window).bind("resize", function() { requestAnimationFrame(function() {}); }); $(window).bind("hashchange", () => initialize(location.hash || location.pathname)); }); </script> </body> </html>